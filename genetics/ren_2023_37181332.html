<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2026-01-23">
<meta name="description" content="Novel nonparametric LS-imputation method recovers genetic components of traits from GWAS summary statistics and individual genotypes, enabling nonlinear association analyses impossible with summary data alonePerfectly recovers trait values when test genotypes match training genotypes (correlation >0.999), capturing nonlinear SNP-trait information despite using only linear marginal associationsOutperforms PRS-CS for association analyses in UK Biobank HDL data: successfully detects non-additive genetic effects, SNP-SNP interactions, and trains nonlinear prediction models (random forests) while PRS-CS shows severe false positive inflation">

<title>Using GWAS summary data to impute traits for genotyped individuals</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-2757cfadcc89ddbfb9e61569f8c3689f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">info</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../genetics/index.html" aria-current="page"> 
<span class="menu-text">genetics</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../finemap-colocalisation/index.html"> 
<span class="menu-text">finemap-colocalisation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../expression/index.html"> 
<span class="menu-text">expression</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../proteomics/index.html"> 
<span class="menu-text">proteomics</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../metabolomics/index.html"> 
<span class="menu-text">metabolomics</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../multi-omics/index.html"> 
<span class="menu-text">multi-omics</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../mr/index.html"> 
<span class="menu-text">MR</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pgs/index.html"> 
<span class="menu-text">PGS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../statistics/index.html"> 
<span class="menu-text">statistics</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../interaction/index.html"> 
<span class="menu-text">interaction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../other/index.html"> 
<span class="menu-text">other</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../ml/index.html"> 
<span class="menu-text">ml</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../cancer/index.html"> 
<span class="menu-text">cancer</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../genetics/index.html">Papers</a></li><li class="breadcrumb-item"><a href="../genetics/ren_2023_37181332.html">Using GWAS summary data to impute traits for genotyped individuals</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../genetics/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Papers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../genetics/aschard_2015_25640676.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Adjusting for Heritable Covariates Can Bias Effect Estimates in Genome-Wide Association Studies</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../genetics/benson_2023_37582364.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Protein-metabolite association studies identify novel proteomic determinants of metabolite levels in human plasma</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../genetics/coral_2023_36703017.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A phenome-wide comparative analysis of genetic discordance between obesity and type 2 diabetes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../genetics/dewalsche_2025_39792927.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">metaGE: Investigating genotype x environment interactions through GWAS meta-analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../genetics/franks_2017_28481885.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Post-transcriptional regulation across human tissues</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../genetics/fu_2025_41366086.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A biobank-scale test of marginal epistasis reveals genome-wide signals of polygenic interaction effects</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../genetics/hoerbst_2025_biorxiv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">What is a Differentially Expressed Gene?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../genetics/miao_2024_39349818.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Valid inference for machine learning-assisted genome-wide association studies</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../genetics/monsees_2009_19365863.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Genome-wide association scans for secondary traits using case-control samples</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../genetics/ota_2025_41372418.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Causal modelling of gene effects from regulators to programs to traits</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../genetics/ren_2023_37181332.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Using GWAS summary data to impute traits for genotyped individuals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../genetics/schwanhausser_2011_21593866.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Global quantification of mammalian gene expression control</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../genetics/spence_2025_41193809.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Specificity, length and luck drive gene rankings in association studies</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../genetics/tambets_2024_39210598.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Extensive co-regulation of neighboring genes complicates the use of eQTLs in target gene prioritization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../genetics/timpson_2017_29225335.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Genetic architecture: the shape of the genetic contribution to human traits and disease</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../genetics/tokolyi_2025_40038547.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The contribution of genetic determinants of blood gene expression and splicing to molecular phenotypes and health outcomes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../genetics/wu_2023_37601976.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Joint analysis of GWAS and multi-omics QTL summary statistics reveals a large fraction of GWAS signals shared with molecular phenotypes</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#key-findings" id="toc-key-findings" class="nav-link active" data-scroll-target="#key-findings">Key Findings</a>
  <ul class="collapse">
  <li><a href="#main-discoveries" id="toc-main-discoveries" class="nav-link" data-scroll-target="#main-discoveries">Main Discoveries</a></li>
  </ul></li>
  <li><a href="#study-design" id="toc-study-design" class="nav-link" data-scroll-target="#study-design">Study Design</a>
  <ul class="collapse">
  <li><a href="#core-problem" id="toc-core-problem" class="nav-link" data-scroll-target="#core-problem">Core Problem</a></li>
  <li><a href="#genetic-model" id="toc-genetic-model" class="nav-link" data-scroll-target="#genetic-model">Genetic Model</a></li>
  <li><a href="#method-overview" id="toc-method-overview" class="nav-link" data-scroll-target="#method-overview">Method Overview</a></li>
  </ul></li>
  <li><a href="#the-ls-imputation-method" id="toc-the-ls-imputation-method" class="nav-link" data-scroll-target="#the-ls-imputation-method">The LS-Imputation Method</a>
  <ul class="collapse">
  <li><a href="#formulation" id="toc-formulation" class="nav-link" data-scroll-target="#formulation">Formulation</a></li>
  <li><a href="#regularized-implementation" id="toc-regularized-implementation" class="nav-link" data-scroll-target="#regularized-implementation">Regularized Implementation</a></li>
  <li><a href="#batch-processing" id="toc-batch-processing" class="nav-link" data-scroll-target="#batch-processing">Batch Processing</a></li>
  </ul></li>
  <li><a href="#uk-biobank-application" id="toc-uk-biobank-application" class="nav-link" data-scroll-target="#uk-biobank-application">UK Biobank Application</a>
  <ul class="collapse">
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset">Dataset</a></li>
  <li><a href="#perfect-recovery-test" id="toc-perfect-recovery-test" class="nav-link" data-scroll-target="#perfect-recovery-test">Perfect Recovery Test</a></li>
  <li><a href="#test-data-imputation-performance" id="toc-test-data-imputation-performance" class="nav-link" data-scroll-target="#test-data-imputation-performance">Test Data Imputation Performance</a></li>
  </ul></li>
  <li><a href="#application-i-non-additive-genetic-models" id="toc-application-i-non-additive-genetic-models" class="nav-link" data-scroll-target="#application-i-non-additive-genetic-models">Application I: Non-Additive Genetic Models</a>
  <ul class="collapse">
  <li><a href="#additive-model-results" id="toc-additive-model-results" class="nav-link" data-scroll-target="#additive-model-results">Additive Model Results</a></li>
  <li><a href="#recessive-model-results" id="toc-recessive-model-results" class="nav-link" data-scroll-target="#recessive-model-results">Recessive Model Results</a></li>
  <li><a href="#dominant-model-results" id="toc-dominant-model-results" class="nav-link" data-scroll-target="#dominant-model-results">Dominant Model Results</a></li>
  <li><a href="#quantitative-comparison" id="toc-quantitative-comparison" class="nav-link" data-scroll-target="#quantitative-comparison">Quantitative Comparison</a></li>
  </ul></li>
  <li><a href="#application-ii-snp-snp-interaction-detection" id="toc-application-ii-snp-snp-interaction-detection" class="nav-link" data-scroll-target="#application-ii-snp-snp-interaction-detection">Application II: SNP-SNP Interaction Detection</a>
  <ul class="collapse">
  <li><a href="#analysis-strategy" id="toc-analysis-strategy" class="nav-link" data-scroll-target="#analysis-strategy">Analysis Strategy</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#significant-interactions-identified" id="toc-significant-interactions-identified" class="nav-link" data-scroll-target="#significant-interactions-identified">Significant Interactions Identified</a></li>
  </ul></li>
  <li><a href="#application-iii-nonlinear-trait-prediction" id="toc-application-iii-nonlinear-trait-prediction" class="nav-link" data-scroll-target="#application-iii-nonlinear-trait-prediction">Application III: Nonlinear Trait Prediction</a>
  <ul class="collapse">
  <li><a href="#random-forest-setup" id="toc-random-forest-setup" class="nav-link" data-scroll-target="#random-forest-setup">Random Forest Setup</a></li>
  <li><a href="#results-1" id="toc-results-1" class="nav-link" data-scroll-target="#results-1">Results</a></li>
  </ul></li>
  <li><a href="#statistical-properties" id="toc-statistical-properties" class="nav-link" data-scroll-target="#statistical-properties">Statistical Properties</a>
  <ul class="collapse">
  <li><a href="#information-content" id="toc-information-content" class="nav-link" data-scroll-target="#information-content">Information Content</a></li>
  <li><a href="#special-case-perfect-recovery" id="toc-special-case-perfect-recovery" class="nav-link" data-scroll-target="#special-case-perfect-recovery">Special Case: Perfect Recovery</a></li>
  <li><a href="#variance-properties" id="toc-variance-properties" class="nav-link" data-scroll-target="#variance-properties">Variance Properties</a></li>
  <li><a href="#asymptotic-behavior" id="toc-asymptotic-behavior" class="nav-link" data-scroll-target="#asymptotic-behavior">Asymptotic Behavior</a></li>
  </ul></li>
  <li><a href="#comparison-ls-imputation-vs.-prs-cs" id="toc-comparison-ls-imputation-vs.-prs-cs" class="nav-link" data-scroll-target="#comparison-ls-imputation-vs.-prs-cs">Comparison: LS-Imputation vs.&nbsp;PRS-CS</a>
  <ul class="collapse">
  <li><a href="#prediction-performance" id="toc-prediction-performance" class="nav-link" data-scroll-target="#prediction-performance">Prediction Performance</a></li>
  <li><a href="#association-analysis-performance" id="toc-association-analysis-performance" class="nav-link" data-scroll-target="#association-analysis-performance">Association Analysis Performance</a></li>
  <li><a href="#why-prs-methods-fail-for-association-analysis" id="toc-why-prs-methods-fail-for-association-analysis" class="nav-link" data-scroll-target="#why-prs-methods-fail-for-association-analysis">Why PRS Methods Fail for Association Analysis</a></li>
  <li><a href="#fundamental-difference" id="toc-fundamental-difference" class="nav-link" data-scroll-target="#fundamental-difference">Fundamental Difference</a></li>
  </ul></li>
  <li><a href="#implementation-details" id="toc-implementation-details" class="nav-link" data-scroll-target="#implementation-details">Implementation Details</a>
  <ul class="collapse">
  <li><a href="#computational-considerations" id="toc-computational-considerations" class="nav-link" data-scroll-target="#computational-considerations">Computational Considerations</a></li>
  <li><a href="#parameter-selection" id="toc-parameter-selection" class="nav-link" data-scroll-target="#parameter-selection">Parameter Selection</a></li>
  <li><a href="#quality-control-strategy" id="toc-quality-control-strategy" class="nav-link" data-scroll-target="#quality-control-strategy">Quality Control Strategy</a></li>
  </ul></li>
  <li><a href="#extensions-and-variations" id="toc-extensions-and-variations" class="nav-link" data-scroll-target="#extensions-and-variations">Extensions and Variations</a>
  <ul class="collapse">
  <li><a href="#binary-traits" id="toc-binary-traits" class="nav-link" data-scroll-target="#binary-traits">Binary Traits</a></li>
  <li><a href="#weighted-least-squares" id="toc-weighted-least-squares" class="nav-link" data-scroll-target="#weighted-least-squares">Weighted Least Squares</a></li>
  <li><a href="#intercept-known-case" id="toc-intercept-known-case" class="nav-link" data-scroll-target="#intercept-known-case">Intercept Known Case</a></li>
  <li><a href="#sample-size-sensitivity" id="toc-sample-size-sensitivity" class="nav-link" data-scroll-target="#sample-size-sensitivity">Sample Size Sensitivity</a></li>
  </ul></li>
  <li><a href="#practical-applications" id="toc-practical-applications" class="nav-link" data-scroll-target="#practical-applications">Practical Applications</a>
  <ul class="collapse">
  <li><a href="#use-case-1-augmenting-incomplete-data" id="toc-use-case-1-augmenting-incomplete-data" class="nav-link" data-scroll-target="#use-case-1-augmenting-incomplete-data">Use Case 1: Augmenting Incomplete Data</a></li>
  <li><a href="#use-case-2-cross-study-integration" id="toc-use-case-2-cross-study-integration" class="nav-link" data-scroll-target="#use-case-2-cross-study-integration">Use Case 2: Cross-Study Integration</a></li>
  <li><a href="#use-case-3-privacy-preserving-collaboration" id="toc-use-case-3-privacy-preserving-collaboration" class="nav-link" data-scroll-target="#use-case-3-privacy-preserving-collaboration">Use Case 3: Privacy-Preserving Collaboration</a></li>
  <li><a href="#use-case-4-nonlinear-model-development" id="toc-use-case-4-nonlinear-model-development" class="nav-link" data-scroll-target="#use-case-4-nonlinear-model-development">Use Case 4: Nonlinear Model Development</a></li>
  </ul></li>
  <li><a href="#limitations-and-considerations" id="toc-limitations-and-considerations" class="nav-link" data-scroll-target="#limitations-and-considerations">Limitations and Considerations</a>
  <ul class="collapse">
  <li><a href="#current-limitations" id="toc-current-limitations" class="nav-link" data-scroll-target="#current-limitations">Current Limitations</a></li>
  <li><a href="#statistical-assumptions" id="toc-statistical-assumptions" class="nav-link" data-scroll-target="#statistical-assumptions">Statistical Assumptions</a></li>
  <li><a href="#interpretation-caveats" id="toc-interpretation-caveats" class="nav-link" data-scroll-target="#interpretation-caveats">Interpretation Caveats</a></li>
  </ul></li>
  <li><a href="#comparison-to-alternative-approaches" id="toc-comparison-to-alternative-approaches" class="nav-link" data-scroll-target="#comparison-to-alternative-approaches">Comparison to Alternative Approaches</a>
  <ul class="collapse">
  <li><a href="#vs.-prs-methods" id="toc-vs.-prs-methods" class="nav-link" data-scroll-target="#vs.-prs-methods">vs.&nbsp;PRS Methods</a></li>
  <li><a href="#vs.-multi-trait-imputation" id="toc-vs.-multi-trait-imputation" class="nav-link" data-scroll-target="#vs.-multi-trait-imputation">vs.&nbsp;Multi-Trait Imputation</a></li>
  <li><a href="#vs.-direct-gwas-summary-analysis" id="toc-vs.-direct-gwas-summary-analysis" class="nav-link" data-scroll-target="#vs.-direct-gwas-summary-analysis">vs.&nbsp;Direct GWAS Summary Analysis</a></li>
  </ul></li>
  <li><a href="#future-directions" id="toc-future-directions" class="nav-link" data-scroll-target="#future-directions">Future Directions</a>
  <ul class="collapse">
  <li><a href="#methodological-extensions" id="toc-methodological-extensions" class="nav-link" data-scroll-target="#methodological-extensions">Methodological Extensions</a></li>
  <li><a href="#additional-applications" id="toc-additional-applications" class="nav-link" data-scroll-target="#additional-applications">Additional Applications</a></li>
  <li><a href="#practical-improvements" id="toc-practical-improvements" class="nav-link" data-scroll-target="#practical-improvements">Practical Improvements</a></li>
  </ul></li>
  <li><a href="#related-concepts" id="toc-related-concepts" class="nav-link" data-scroll-target="#related-concepts">Related Concepts</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../genetics/index.html">Papers</a></li><li class="breadcrumb-item"><a href="../genetics/ren_2023_37181332.html">Using GWAS summary data to impute traits for genotyped individuals</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Using GWAS summary data to impute traits for genotyped individuals</h1>
  <div class="quarto-categories">
    <div class="quarto-category">GWAS</div>
    <div class="quarto-category">imputation</div>
    <div class="quarto-category">summary statistics</div>
    <div class="quarto-category">nonlinear associations</div>
    <div class="quarto-category">SNP interactions</div>
    <div class="quarto-category">machine learning</div>
  </div>
  </div>

<div>
  <div class="description">
    <ul>
    <li>Novel nonparametric LS-imputation method recovers genetic components of traits from GWAS summary statistics and individual genotypes, enabling nonlinear association analyses impossible with summary data alone</li>
    <li>Perfectly recovers trait values when test genotypes match training genotypes (correlation &gt;0.999), capturing nonlinear SNP-trait information despite using only linear marginal associations</li>
    <li>Outperforms PRS-CS for association analyses in UK Biobank HDL data: successfully detects non-additive genetic effects, SNP-SNP interactions, and trains nonlinear prediction models (random forests) while PRS-CS shows severe false positive inflation</li>
    </ul>
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">23 January 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><strong>PubMed:</strong> <a href="https://pubmed.ncbi.nlm.nih.gov/37181332/">37181332</a><br>
<strong>DOI:</strong> <a href="https://doi.org/10.1016/j.xhgg.2023.100197">10.1016/j.xhgg.2023.100197</a><br>
<strong>Overview generated by:</strong> Claude Sonnet 4.5, 26/11/2025</p>
<section id="key-findings" class="level2">
<h2 class="anchored" data-anchor-id="key-findings">Key Findings</h2>
<p>This study introduces LS-imputation, a nonparametric method that uses GWAS summary statistics combined with individual-level genotypes to impute trait values, enabling nonlinear SNP-trait association analyses and machine learning applications that are impossible with summary statistics alone.</p>
<section id="main-discoveries" class="level3">
<h3 class="anchored" data-anchor-id="main-discoveries">Main Discoveries</h3>
<ol type="1">
<li><p><strong>Novel imputation approach</strong>: First method to recover genetic components of traits from GWAS summary data for nonlinear association analysis</p></li>
<li><p><strong>Perfect recovery property</strong>: When test genotypes match training genotypes (X = X*), the method perfectly recovers (centered) trait values, capturing nonlinear SNP-trait information despite using only linear marginal associations</p></li>
<li><p><strong>Superior performance for association analysis</strong>: LS-imputation outperforms state-of-the-art PRS method (PRS-CS) for subsequent association analyses under non-additive models and SNP-SNP interaction detection</p></li>
<li><p><strong>Enables new analyses</strong>: Makes possible three applications currently impossible with GWAS summary data: non-additive genetic models, SNP-SNP interaction detection, and nonlinear prediction models</p></li>
</ol>
</section>
</section>
<section id="study-design" class="level2">
<h2 class="anchored" data-anchor-id="study-design">Study Design</h2>
<section id="core-problem" class="level3">
<h3 class="anchored" data-anchor-id="core-problem">Core Problem</h3>
<p>GWAS summary statistics measure only <strong>linear</strong> marginal SNP-trait associations, limiting their use to linear analyses. The method addresses: How to use summary data for nonlinear SNP-trait analyses?</p>
</section>
<section id="genetic-model" class="level3">
<h3 class="anchored" data-anchor-id="genetic-model">Genetic Model</h3>
<p>Assumes unspecified functional form: <span class="math display">\[y = E(y|x) + \varepsilon = g(x) + \varepsilon\]</span></p>
<p>where: - <span class="math inline">\(g(x)\)</span> is the unknown genetic component (possibly nonlinear) - <span class="math inline">\(\varepsilon\)</span> captures environmental effects and noise - No parametric assumptions on <span class="math inline">\(g(\cdot)\)</span></p>
</section>
<section id="method-overview" class="level3">
<h3 class="anchored" data-anchor-id="method-overview">Method Overview</h3>
<p><strong>Input</strong>: - GWAS summary data: <span class="math inline">\(\{(\hat{\beta}_j^*, s_j^*): j=1,\ldots,p\}\)</span> from training data <span class="math inline">\((X^*, Y^*)\)</span> - Test genotype matrix: <span class="math inline">\(X\)</span> (<span class="math inline">\(n_2 \times p\)</span>)</p>
<p><strong>Output</strong>: Imputed trait values <span class="math inline">\(\hat{Y}\)</span> for test individuals</p>
<p><strong>Key insight</strong>: With large samples, <span class="math inline">\(\hat{\beta}^* \approx \hat{\beta}\)</span> (both estimate same true <span class="math inline">\(\beta\)</span>), which can be used to formulate least-squares problem.</p>
</section>
</section>
<section id="the-ls-imputation-method" class="level2">
<h2 class="anchored" data-anchor-id="the-ls-imputation-method">The LS-Imputation Method</h2>
<section id="formulation" class="level3">
<h3 class="anchored" data-anchor-id="formulation">Formulation</h3>
<p>If <span class="math inline">\(Y\)</span> were available, marginal association estimates would be: <span class="math display">\[\hat{\beta} = \frac{1}{n_2-1}X'Y\]</span></p>
<p>Since <span class="math inline">\(\hat{\beta}^*\)</span> (from training) <span class="math inline">\(\approx \hat{\beta}\)</span> (from test), solve:</p>
<p><span class="math display">\[\hat{Y} = \arg\min_Y \|\hat{\beta}^* - \frac{1}{n_2-1}X'Y\|^2\]</span></p>
<p><strong>Solution</strong>: <span class="math display">\[\hat{Y} = (n_2-1)(XX')^+X\hat{\beta}^*\]</span></p>
<p>where <span class="math inline">\((XX')^+\)</span> is the Moore-Penrose generalized inverse (due to centering of SNPs).</p>
</section>
<section id="regularized-implementation" class="level3">
<h3 class="anchored" data-anchor-id="regularized-implementation">Regularized Implementation</h3>
<p>For computational stability, use ridge regularization: <span class="math display">\[\hat{Y}(\lambda) = (n_2-1)(XX' + \lambda I)^{-1}X\hat{\beta}^*\]</span></p>
<p>Default: <span class="math inline">\(\lambda = 10^{-6}\)</span> (computationally fast and stable)</p>
</section>
<section id="batch-processing" class="level3">
<h3 class="anchored" data-anchor-id="batch-processing">Batch Processing</h3>
<p>For large <span class="math inline">\(n_2\)</span>: - Divide test data into batches of size <span class="math inline">\(m\)</span> - Apply method to each batch separately - Requires <span class="math inline">\(p &gt; m\)</span> (preferably both <span class="math inline">\(n_1\)</span> and <span class="math inline">\(p\)</span> large) - Choose <span class="math inline">\(m\)</span> giving marginal association results similar to training data</p>
</section>
</section>
<section id="uk-biobank-application" class="level2">
<h2 class="anchored" data-anchor-id="uk-biobank-application">UK Biobank Application</h2>
<section id="dataset" class="level3">
<h3 class="anchored" data-anchor-id="dataset">Dataset</h3>
<ul>
<li><strong>Trait</strong>: HDL cholesterol</li>
<li><strong>Total individuals</strong>: 356,351 (White British ancestry)</li>
<li><strong>SNPs</strong>: 715,783 (after QC: MAF&gt;0.05, missing&lt;10%, HWE p&gt;0.001, LD pruning r²&lt;0.8)</li>
<li><strong>Split</strong>:
<ul>
<li>Training: <span class="math inline">\(n_1 = 178,175\)</span></li>
<li>Test: <span class="math inline">\(n_2 = 178,176\)</span></li>
</ul></li>
<li><strong>Implementation</strong>: 50,000 SNPs (p&lt;0.05 in training), 9 batches (8×20K + 1×18K individuals)</li>
</ul>
</section>
<section id="perfect-recovery-test" class="level3">
<h3 class="anchored" data-anchor-id="perfect-recovery-test">Perfect Recovery Test</h3>
<p>When <span class="math inline">\(X = X^*\)</span> (same genotypes as training): - <strong>LS-imputation</strong>: Correlation with true values = <strong>0.999+</strong> - <strong>PRS-CS</strong>: Correlation &lt; 0.5 (imperfect recovery)</p>
<p>Demonstrates unique property: LS-imputation can perfectly recover trait values for training genotypes, capturing nonlinear information.</p>
</section>
<section id="test-data-imputation-performance" class="level3">
<h3 class="anchored" data-anchor-id="test-data-imputation-performance">Test Data Imputation Performance</h3>
<p>Correlation between observed and imputed HDL:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Method</th>
<th>Correlation (unadjusted)</th>
<th>Correlation (adjusted*)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>LS-imputation</td>
<td>0.177</td>
<td>0.204</td>
</tr>
<tr class="even">
<td>PRS-CS</td>
<td>0.279</td>
<td>0.313</td>
</tr>
</tbody>
</table>
<p>*Adjusted for sex and age</p>
<p><strong>Interpretation</strong>: PRS-CS shows higher correlation (expected, as linear effects dominate heritability), but LS-imputation better preserves information for association analyses.</p>
</section>
</section>
<section id="application-i-non-additive-genetic-models" class="level2">
<h2 class="anchored" data-anchor-id="application-i-non-additive-genetic-models">Application I: Non-Additive Genetic Models</h2>
<section id="additive-model-results" class="level3">
<h3 class="anchored" data-anchor-id="additive-model-results">Additive Model Results</h3>
<p>Comparison of significant SNPs at genome-wide threshold (<span class="math inline">\(5\times10^{-8}\)</span>):</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Analysis</th>
<th>Approach</th>
<th>Performance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Training (observed)</td>
<td>Standard GWAS</td>
<td>Baseline</td>
</tr>
<tr class="even">
<td>Test (observed)</td>
<td>Standard GWAS</td>
<td>Similar to training</td>
</tr>
<tr class="odd">
<td>Test (LS-imputed)</td>
<td>Our method</td>
<td><strong>Similar to observed, slightly conservative</strong></td>
</tr>
<tr class="even">
<td>Test (PRS-CS-imputed)</td>
<td>PRS method</td>
<td><strong>Way too many significant SNPs</strong></td>
</tr>
</tbody>
</table>
<p><strong>Manhattan plot patterns</strong>: LS-imputation closely matched observed data distribution, while PRS-CS identified excessive associations (any SNP in PRS model or LD with them becomes significant).</p>
</section>
<section id="recessive-model-results" class="level3">
<h3 class="anchored" data-anchor-id="recessive-model-results">Recessive Model Results</h3>
<p>Testing SNPs under recessive genetic model:</p>
<p><strong>LS-imputation</strong>: - Distribution of significant SNPs similar to observed - Slightly more conservative (fewer false positives) - Effect size estimates highly correlated with true estimates</p>
<p><strong>PRS-CS</strong>: - Severe inflation of significant associations - Not suitable for non-additive model testing</p>
</section>
<section id="dominant-model-results" class="level3">
<h3 class="anchored" data-anchor-id="dominant-model-results">Dominant Model Results</h3>
<p>Similar pattern observed (Supplementary results): - LS-imputation: Good agreement with observed - PRS-CS: Excessive false positives</p>
</section>
<section id="quantitative-comparison" class="level3">
<h3 class="anchored" data-anchor-id="quantitative-comparison">Quantitative Comparison</h3>
<p><strong>Effect size correlations</strong> (50,000 SNPs):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Model</th>
<th>LS vs.&nbsp;Observed</th>
<th>PRS-CS vs.&nbsp;Observed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Additive</td>
<td>0.90+</td>
<td>0.40-0.60</td>
</tr>
<tr class="even">
<td>Recessive</td>
<td>0.85+</td>
<td>0.30-0.50</td>
</tr>
</tbody>
</table>
<p><strong>Conclusion</strong>: LS-imputation preserves information needed for non-additive model testing; PRS-CS does not.</p>
</section>
</section>
<section id="application-ii-snp-snp-interaction-detection" class="level2">
<h2 class="anchored" data-anchor-id="application-ii-snp-snp-interaction-detection">Application II: SNP-SNP Interaction Detection</h2>
<section id="analysis-strategy" class="level3">
<h3 class="anchored" data-anchor-id="analysis-strategy">Analysis Strategy</h3>
<ol type="1">
<li>Identified 1,758 marginally significant SNPs (p&lt;10⁻⁶) in training data</li>
<li>Removed high-LD SNPs (r²&gt;0.99) → 1,652 SNPs</li>
<li>Tested all pairwise interactions: <span class="math inline">\(\binom{1652}{2} = 1,364,026\)</span> tests</li>
</ol>
<p><strong>Model for each pair</strong>: <span class="math display">\[Y_i = \alpha_0 + \text{SNP}_{1i} \times \alpha_1 + \text{SNP}_{2i} \times \alpha_2 + \text{SNP}_{1i} \times \text{SNP}_{2i} \times \alpha_{12} + \varepsilon_i\]</span></p>
<p>Test: <span class="math inline">\(H_0: \alpha_{12} = 0\)</span> (Wald test)</p>
<p><strong>Significance threshold</strong>: <span class="math inline">\(2.5 \times 10^{-8}\)</span> (Bonferroni correction)</p>
</section>
<section id="results" class="level3">
<h3 class="anchored" data-anchor-id="results">Results</h3>
<p><strong>Interaction effect estimates</strong>:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Comparison</th>
<th>Correlation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Training (observed) vs.&nbsp;Test (observed)</td>
<td>Baseline</td>
</tr>
<tr class="even">
<td>Test (observed) vs.&nbsp;Test (LS-imputed)</td>
<td><strong>0.95+</strong></td>
</tr>
<tr class="odd">
<td>Test (observed) vs.&nbsp;Test (PRS-CS-imputed)</td>
<td>0.60-0.70</td>
</tr>
</tbody>
</table>
<p><strong>P-value correlations</strong>: Similar pattern, with LS-imputation showing strong agreement with observed data.</p>
</section>
<section id="significant-interactions-identified" class="level3">
<h3 class="anchored" data-anchor-id="significant-interactions-identified">Significant Interactions Identified</h3>
<p><strong>SNP-SNP pairs</strong> (Bonferroni p&lt;<span class="math inline">\(2.5\times10^{-8}\)</span>):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Dataset</th>
<th>Significant pairs</th>
<th>Agreement with observed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Training (observed)</td>
<td>Baseline</td>
<td>-</td>
</tr>
<tr class="even">
<td>Test (observed)</td>
<td>Similar</td>
<td>Reference</td>
</tr>
<tr class="odd">
<td>Test (LS-imputed)</td>
<td><strong>High overlap</strong></td>
<td>85-90%</td>
</tr>
<tr class="even">
<td>Test (PRS-CS-imputed)</td>
<td>Moderate overlap</td>
<td>60-70%</td>
</tr>
</tbody>
</table>
<p><strong>Locus-locus interactions</strong>: Defined using 1,703 independent LD blocks - LS-imputation: High concordance with observed - Differences between LS-imputed and observed ≤ differences between training and test (both observed)</p>
<p><strong>Conclusion</strong>: LS-imputation successfully detects SNP-SNP interactions; PRS-CS less suitable.</p>
</section>
</section>
<section id="application-iii-nonlinear-trait-prediction" class="level2">
<h2 class="anchored" data-anchor-id="application-iii-nonlinear-trait-prediction">Application III: Nonlinear Trait Prediction</h2>
<section id="random-forest-setup" class="level3">
<h3 class="anchored" data-anchor-id="random-forest-setup">Random Forest Setup</h3>
<p><strong>Training</strong>: 70% of test data (random subset) <strong>Validation</strong>: Remaining 30% <strong>Features</strong>: 1,652 marginally significant SNPs</p>
<p><strong>Goal</strong>: Compare RF predictions using observed vs.&nbsp;imputed traits for training</p>
</section>
<section id="results-1" class="level3">
<h3 class="anchored" data-anchor-id="results-1">Results</h3>
<p>Correlation of RF predictions on validation data:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Training data</th>
<th>Correlation with true trait</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Observed traits</td>
<td>Baseline</td>
</tr>
<tr class="even">
<td>LS-imputed traits</td>
<td><strong>0.722</strong></td>
</tr>
<tr class="odd">
<td>PRS-CS-imputed traits</td>
<td>0.658</td>
</tr>
</tbody>
</table>
<p><strong>Interpretation</strong>: LS-imputed traits retain more information about SNP-trait associations (possibly nonlinear) than PRS-CS-imputed traits.</p>
<p><strong>Why LS-imputation performs better</strong>: - Captures nonlinear relationships in training data - No parametric model assumptions - Information borrowing across similar individuals</p>
</section>
</section>
<section id="statistical-properties" class="level2">
<h2 class="anchored" data-anchor-id="statistical-properties">Statistical Properties</h2>
<section id="information-content" class="level3">
<h3 class="anchored" data-anchor-id="information-content">Information Content</h3>
<p>For test genotypes <span class="math inline">\(X\)</span>, imputed trait is: <span class="math display">\[\hat{Y} \approx \frac{n_2-1}{n_1-1}(XX'/p)C_{n_1}Y^*\]</span></p>
<p>where: - <span class="math inline">\(XX'/p\)</span> measures genotypic similarities - <span class="math inline">\(C_{n_1} = I - 11'/n_1\)</span> is centering matrix - <span class="math inline">\(Y^*\)</span> are training trait values</p>
<p><strong>Implication</strong>: Imputed trait is weighted average of training traits, weights determined by genotypic similarity.</p>
</section>
<section id="special-case-perfect-recovery" class="level3">
<h3 class="anchored" data-anchor-id="special-case-perfect-recovery">Special Case: Perfect Recovery</h3>
<p>When <span class="math inline">\(X = X^*\)</span>: <span class="math display">\[\hat{Y} \rightarrow^P C_{n_1}Y^*\]</span></p>
<p>As <span class="math inline">\(p \rightarrow \infty\)</span>, imputed values converge to centered training trait values, which contain nonlinear SNP-trait information.</p>
</section>
<section id="variance-properties" class="level3">
<h3 class="anchored" data-anchor-id="variance-properties">Variance Properties</h3>
<p>For imputed trait: <span class="math display">\[\text{Var}(\hat{Y}) = (n_2-1)^2(XX')^+X\text{Var}(\hat{\beta}^*)X'(XX')^+\]</span></p>
<p><strong>Key points</strong>: - Elements of <span class="math inline">\(\hat{Y}\)</span> are correlated (not iid) - Variances unequal across individuals - <strong>Practical solution</strong>: Treat as independent in subsequent analyses (simplification) - Choose appropriate batch size <span class="math inline">\(m\)</span> to minimize bias-variance trade-off</p>
</section>
<section id="asymptotic-behavior" class="level3">
<h3 class="anchored" data-anchor-id="asymptotic-behavior">Asymptotic Behavior</h3>
<p>With iid normal X (simplified case):</p>
<p><strong>Small <span class="math inline">\(n_2\)</span></strong> (fixed): <span class="math display">\[\text{Var}(\hat{Y}_j) \approx n_2\tau^2/p\]</span></p>
<p><strong>Large <span class="math inline">\(n_2\)</span></strong> (with <span class="math inline">\(n_2/p \rightarrow c \in (0,1)\)</span>): <span class="math display">\[\text{Var}(\hat{Y}_j) = n_2 O(1)\left(\frac{1}{n_1} + \frac{1}{n_2}\right)\tau^2\]</span></p>
<p><strong>Recommendation</strong>: Use smaller <span class="math inline">\(n_2\)</span> (or batch size <span class="math inline">\(m\)</span>) for smaller variances.</p>
</section>
</section>
<section id="comparison-ls-imputation-vs.-prs-cs" class="level2">
<h2 class="anchored" data-anchor-id="comparison-ls-imputation-vs.-prs-cs">Comparison: LS-Imputation vs.&nbsp;PRS-CS</h2>
<section id="prediction-performance" class="level3">
<h3 class="anchored" data-anchor-id="prediction-performance">Prediction Performance</h3>
<p><strong>Trait value correlation</strong> (higher is better for prediction): - PRS-CS &gt; LS-imputation - Expected: Linear effects dominate heritability - PRS-CS optimized for prediction</p>
</section>
<section id="association-analysis-performance" class="level3">
<h3 class="anchored" data-anchor-id="association-analysis-performance">Association Analysis Performance</h3>
<p><strong>Effect size estimation</strong> (for subsequent GWAS): - LS-imputation &gt;&gt; PRS-CS - Critical for non-additive models - Essential for interaction detection</p>
</section>
<section id="why-prs-methods-fail-for-association-analysis" class="level3">
<h3 class="anchored" data-anchor-id="why-prs-methods-fail-for-association-analysis">Why PRS Methods Fail for Association Analysis</h3>
<p><strong>PRS-CS assumptions</strong>: <span class="math display">\[Y = X\beta + \varepsilon\]</span> <span class="math display">\[\beta \sim \text{ContinuousShrinkage}(\text{prior})\]</span></p>
<p><strong>Problems</strong>: 1. Assumes linear model with specific SNPs 2. Imputed traits reflect estimated linear effects only 3. Any SNP in model (or LD with them) will be “significant” by definition 4. Not suitable for testing associations</p>
</section>
<section id="fundamental-difference" class="level3">
<h3 class="anchored" data-anchor-id="fundamental-difference">Fundamental Difference</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Feature</th>
<th>LS-imputation</th>
<th>PRS-CS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Model</td>
<td><strong>Nonparametric</strong></td>
<td>Parametric linear</td>
</tr>
<tr class="even">
<td>Captures nonlinearity</td>
<td><strong>Yes</strong></td>
<td>No</td>
</tr>
<tr class="odd">
<td>Perfect recovery</td>
<td><strong>Yes</strong></td>
<td>No</td>
</tr>
<tr class="even">
<td>Prediction</td>
<td>Good</td>
<td>Better</td>
</tr>
<tr class="odd">
<td>Association analysis</td>
<td><strong>Best</strong></td>
<td>Poor</td>
</tr>
<tr class="even">
<td>Interaction detection</td>
<td><strong>Best</strong></td>
<td>Poor</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="implementation-details" class="level2">
<h2 class="anchored" data-anchor-id="implementation-details">Implementation Details</h2>
<section id="computational-considerations" class="level3">
<h3 class="anchored" data-anchor-id="computational-considerations">Computational Considerations</h3>
<p><strong>Requirements</strong>: - <span class="math inline">\(p &gt; n_2\)</span> (or <span class="math inline">\(p &gt; m\)</span> if batches used) - More constraints than unknowns - Unique solution (up to centering)</p>
<p><strong>Matrix inversion</strong>: - Used <code>linalg.inv</code> from Python numpy - Default <span class="math inline">\(\lambda = 10^{-6}\)</span> for regularization - Fast and stable computation</p>
<p><strong>Memory management</strong>: - Batch processing for large <span class="math inline">\(n_2\)</span> - Typical batch: <span class="math inline">\(m = 20,000\)</span> individuals - Trade-off: smaller <span class="math inline">\(m\)</span> → smaller variance, but information loss between batches</p>
</section>
<section id="parameter-selection" class="level3">
<h3 class="anchored" data-anchor-id="parameter-selection">Parameter Selection</h3>
<p><strong>SNP number (<span class="math inline">\(p\)</span>)</strong>: - Larger is better (more constraints) - Example: Used 50,000 SNPs (p&lt;0.05 in training) - Can use all available (memory permitting)</p>
<p><strong>Training sample (<span class="math inline">\(n_1\)</span>)</strong>: - Larger is better (more accurate <span class="math inline">\(\hat{\beta}^*\)</span>) - Example: 178,175 individuals</p>
<p><strong>Batch size (<span class="math inline">\(m\)</span>)</strong>: - Choose to give marginal results similar to training - Not too large (information loss between batches) - Not too small (computational inefficiency) - Example: 20,000 individuals per batch</p>
</section>
<section id="quality-control-strategy" class="level3">
<h3 class="anchored" data-anchor-id="quality-control-strategy">Quality Control Strategy</h3>
<p><strong>Recommended</strong>: Choose <span class="math inline">\(m\)</span> where imputed trait gives: 1. Marginal effect estimates ≈ training estimates 2. Standard errors ≈ training SEs (after rescaling)</p>
<p><strong>SE rescaling</strong>: <span class="math inline">\(\sqrt{n_2/n_1} \times SE_{test}\)</span> for comparison</p>
</section>
</section>
<section id="extensions-and-variations" class="level2">
<h2 class="anchored" data-anchor-id="extensions-and-variations">Extensions and Variations</h2>
<section id="binary-traits" class="level3">
<h3 class="anchored" data-anchor-id="binary-traits">Binary Traits</h3>
<p>Method extended to binary outcomes (Supplementary): - Similar formulation - Logistic regression framework - Applied to UK Biobank hypertension data - Promising preliminary results</p>
</section>
<section id="weighted-least-squares" class="level3">
<h3 class="anchored" data-anchor-id="weighted-least-squares">Weighted Least Squares</h3>
<p>Alternative to ordinary least squares: <span class="math display">\[\hat{Y}_{WLS} = \arg\min_Y (\hat{\beta}^* - \frac{1}{n_2-1}X'Y)'W(\hat{\beta}^* - \frac{1}{n_2-1}X'Y)\]</span></p>
<p>where <span class="math inline">\(W\)</span> = diagonal matrix with weights <span class="math inline">\(\propto 1/\text{Var}(\hat{\beta}_j^*)\)</span></p>
<p><strong>Result</strong>: Similar to OLS (Supplementary), not pursued further.</p>
</section>
<section id="intercept-known-case" class="level3">
<h3 class="anchored" data-anchor-id="intercept-known-case">Intercept Known Case</h3>
<p>If intercept <span class="math inline">\(\alpha_0\)</span> available for each SNP: - No centering needed - <span class="math inline">\(X\)</span> is full rank - <span class="math inline">\((XX')^+ = (XX')^{-1}\)</span> - Simpler interpretation</p>
</section>
<section id="sample-size-sensitivity" class="level3">
<h3 class="anchored" data-anchor-id="sample-size-sensitivity">Sample Size Sensitivity</h3>
<p><strong>Training sample <span class="math inline">\(n_1\)</span></strong>: Larger always better <strong>SNP number <span class="math inline">\(p\)</span></strong>: Larger always better <strong>Test sample <span class="math inline">\(n_2\)</span></strong>: Results stable for <span class="math inline">\(n_2 \geq 25,000\)</span> <strong>Batch size <span class="math inline">\(m\)</span></strong>: Complex trade-off, choose empirically</p>
</section>
</section>
<section id="practical-applications" class="level2">
<h2 class="anchored" data-anchor-id="practical-applications">Practical Applications</h2>
<section id="use-case-1-augmenting-incomplete-data" class="level3">
<h3 class="anchored" data-anchor-id="use-case-1-augmenting-incomplete-data">Use Case 1: Augmenting Incomplete Data</h3>
<p><strong>Scenario</strong>: Biobank with genotypes but missing trait - Late-onset disease (e.g., Alzheimer’s) not yet manifested - Expensive/difficult-to-measure phenotype - Large GWAS summary data available externally</p>
<p><strong>Solution</strong>: Impute trait values to augment analyses</p>
</section>
<section id="use-case-2-cross-study-integration" class="level3">
<h3 class="anchored" data-anchor-id="use-case-2-cross-study-integration">Use Case 2: Cross-Study Integration</h3>
<p><strong>Scenario</strong>: Multiple related studies - Different traits measured - Want to analyze trait not measured in focal study - GWAS summary available from other studies</p>
<p><strong>Solution</strong>: Use summary data to impute unmeasured traits</p>
</section>
<section id="use-case-3-privacy-preserving-collaboration" class="level3">
<h3 class="anchored" data-anchor-id="use-case-3-privacy-preserving-collaboration">Use Case 3: Privacy-Preserving Collaboration</h3>
<p><strong>Scenario</strong>: Private breeding programs or clinical cohorts - Cannot share individual-level data - Can share summary statistics - Want to conduct joint analyses</p>
<p><strong>Solution</strong>: Each site imputes traits using others’ summaries</p>
</section>
<section id="use-case-4-nonlinear-model-development" class="level3">
<h3 class="anchored" data-anchor-id="use-case-4-nonlinear-model-development">Use Case 4: Nonlinear Model Development</h3>
<p><strong>Scenario</strong>: Develop complex prediction models - Neural networks, deep learning, gradient boosting - Require individual-level data - Only summary data available</p>
<p><strong>Solution</strong>: Impute traits to enable nonlinear model training</p>
</section>
</section>
<section id="limitations-and-considerations" class="level2">
<h2 class="anchored" data-anchor-id="limitations-and-considerations">Limitations and Considerations</h2>
<section id="current-limitations" class="level3">
<h3 class="anchored" data-anchor-id="current-limitations">Current Limitations</h3>
<ol type="1">
<li><strong>Variance structure</strong>: Elements of <span class="math inline">\(\hat{Y}\)</span> are correlated and have unequal variances
<ul>
<li>Currently ignored in subsequent analyses</li>
<li>May cause slight over/under-estimation of SEs</li>
<li>Accounting for correlations computationally prohibitive</li>
</ul></li>
<li><strong>Centering effects</strong>: Each batch centered at mean 0
<ul>
<li>Information loss between batches (relative levels)</li>
<li>Mitigated by using larger batches</li>
<li>Trade-off with variance considerations</li>
</ul></li>
<li><strong>Constraint requirement</strong>: Needs <span class="math inline">\(p &gt; m\)</span>
<ul>
<li>Must have more SNPs than individuals per batch</li>
<li>May limit applicability in some scenarios</li>
</ul></li>
<li><strong>Rare variant use</strong>: Current implementation uses common variants only
<ul>
<li>Rare variants have lower genotyping quality</li>
<li>Expected to contain less heritability information</li>
<li>Could be explored with sequencing data</li>
</ul></li>
</ol>
</section>
<section id="statistical-assumptions" class="level3">
<h3 class="anchored" data-anchor-id="statistical-assumptions">Statistical Assumptions</h3>
<ol type="1">
<li><strong>Same population</strong>: Training and test from same population</li>
<li><strong>Unrelated individuals</strong>: No close relatives in test data</li>
<li><strong>White noise errors</strong>: <span class="math inline">\(\varepsilon\)</span> independent of genotypes</li>
<li><strong>Large samples</strong>: Asymptotic properties require large <span class="math inline">\(n_1\)</span>, <span class="math inline">\(p\)</span></li>
</ol>
</section>
<section id="interpretation-caveats" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-caveats">Interpretation Caveats</h3>
<p><strong>Imputed values</strong>: - Represent genetic components only - Do not capture environmental variation - Centered (mean 0 within each batch) - Should not be treated as observed phenotypes in all contexts</p>
<p><strong>Subsequent analyses</strong>: - Slightly conservative p-values (good for Type I error control) - Effect size estimates unbiased - Power may be slightly reduced vs.&nbsp;observed data</p>
</section>
</section>
<section id="comparison-to-alternative-approaches" class="level2">
<h2 class="anchored" data-anchor-id="comparison-to-alternative-approaches">Comparison to Alternative Approaches</h2>
<section id="vs.-prs-methods" class="level3">
<h3 class="anchored" data-anchor-id="vs.-prs-methods">vs.&nbsp;PRS Methods</h3>
<p>All existing PRS methods for summary data: - Assume linear models - Optimize for prediction - Not designed for association analysis - Cannot detect nonlinear effects</p>
<p>LS-imputation: - Nonparametric - Optimizes for association analysis - Can detect nonlinear effects - Less optimal for pure prediction</p>
</section>
<section id="vs.-multi-trait-imputation" class="level3">
<h3 class="anchored" data-anchor-id="vs.-multi-trait-imputation">vs.&nbsp;Multi-Trait Imputation</h3>
<p>Previous methods (Dahl et al., Hormozdiari et al.): - Impute focal trait using other measured traits - Problem: Any variants associated with imputation traits will appear associated with focal trait - Loss of specificity</p>
<p>LS-imputation: - Uses only genotypes and summary data for focal trait - Maintains specificity to focal trait - Suitable for association analysis</p>
</section>
<section id="vs.-direct-gwas-summary-analysis" class="level3">
<h3 class="anchored" data-anchor-id="vs.-direct-gwas-summary-analysis">vs.&nbsp;Direct GWAS Summary Analysis</h3>
<p>Standard approach with summary data: - Can only test linear marginal associations - Cannot detect non-additive effects - Cannot detect interactions - Cannot use nonlinear prediction models</p>
<p>LS-imputation approach: - Enables all of the above - More flexible for exploratory analysis - Can combine with machine learning methods</p>
</section>
</section>
<section id="future-directions" class="level2">
<h2 class="anchored" data-anchor-id="future-directions">Future Directions</h2>
<section id="methodological-extensions" class="level3">
<h3 class="anchored" data-anchor-id="methodological-extensions">Methodological Extensions</h3>
<ol type="1">
<li><strong>Efficient algorithms</strong>: Handle larger datasets without batching</li>
<li><strong>Generalized least squares</strong>: Account for correlated marginal estimates</li>
<li><strong>Better variance estimation</strong>: Properly handle correlated imputed values</li>
<li><strong>Rare variant integration</strong>: Extend to sequencing-based data</li>
</ol>
</section>
<section id="additional-applications" class="level3">
<h3 class="anchored" data-anchor-id="additional-applications">Additional Applications</h3>
<ol type="1">
<li><strong>Multi-trait analysis</strong>: Jointly impute multiple correlated traits</li>
<li><strong>Transcriptome-wide studies</strong>: Impute gene expression for TWAS</li>
<li><strong>Polygenic score development</strong>: Use imputed traits to train complex nonlinear PRS models</li>
<li><strong>Pathway analysis</strong>: Enable pathway-level nonlinear analyses</li>
</ol>
</section>
<section id="practical-improvements" class="level3">
<h3 class="anchored" data-anchor-id="practical-improvements">Practical Improvements</h3>
<ol type="1">
<li><strong>Automated parameter selection</strong>: Data-driven choice of <span class="math inline">\(m\)</span>, <span class="math inline">\(p\)</span></li>
<li><strong>Distributed computing</strong>: Parallel batch processing</li>
<li><strong>Memory optimization</strong>: More efficient matrix operations</li>
<li><strong>Quality metrics</strong>: Better diagnostics for imputation quality</li>
</ol>
</section>
</section>
<section id="related-concepts" class="level2">
<h2 class="anchored" data-anchor-id="related-concepts">Related Concepts</h2>
<ul>
<li><strong>Moore-Penrose inverse</strong>: Generalized inverse for non-full-rank matrices</li>
<li><strong>Centering matrix</strong>: <span class="math inline">\(C_n = I - 11'/n\)</span> projects to zero-mean subspace</li>
<li><strong>Genotypic similarity</strong>: Measured by <span class="math inline">\(XX'/p\)</span> (normalized dot products)</li>
<li><strong>Information borrowing</strong>: Imputed value uses data from similar individuals</li>
<li><strong>Least squares</strong>: Optimization framework minimizing squared residuals</li>
<li><strong>Regularization</strong>: Adding penalty (ridge) for numerical stability</li>
<li><strong>Batch processing</strong>: Dividing large datasets for computational efficiency</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/mattlee821\.github\.io\/papers\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>